---
import Layout from '@/layouts/Layout.astro';
import { getWritings } from '@/lib/content-tina';

const writing = await getWritings();
// Sort by date desc
writing.sort((a, b) => new Date(b.date).valueOf() - new Date(a.date).valueOf());

const formatDate = (dateString: string) => {
  if (!dateString) return '';
  const date = new Date(dateString);
  return new Intl.DateTimeFormat('en-GB', {
    day: 'numeric',
    month: 'long',
    year: 'numeric',
  }).format(date);
};
---

<Layout title="Writing | Mark Power">
  <div class="px-6 md:px-12 py-12 max-w-4xl mx-auto">
    <h1 class="text-3xl font-light mb-12 uppercase tracking-wide">Writing</h1>
    
    <div class="flex flex-col gap-16">
      {writing.map((essay) => (
        <article class="group">
          <a href={`/writing/${essay._sys.filename}`} class="flex flex-col md:flex-row gap-8 items-center group">
            {essay.coverImage && (
              <div class="w-full md:w-[30%] shrink-0 overflow-hidden aspect-[16/9] md:aspect-[4/3] bg-muted relative">
                <img 
                  src={essay.coverImage} 
                  alt={essay.title}
                  class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                />
              </div>
            )}
            <div class="flex-1">
                <h2 class="text-2xl font-normal group-hover:text-muted-foreground transition-colors mb-2">
                {essay.title}
                </h2>
                <div class="text-xs uppercase tracking-widest text-muted-foreground mb-4">
                    <time datetime={essay.date}>
                        {formatDate(essay.date)}
                    </time>
                </div>
                {essay.description && (
                    <p class="text-muted-foreground leading-relaxed font-light mb-4">
                        {essay.description}
                    </p>
                )}
                <span class="text-xs border-b border-foreground pb-0.5 hover:border-muted-foreground transition-colors">
                    Read Essay
                </span>
            </div>
          </a>
        </article>
      ))}
    </div>
  </div>
</Layout>
