---
import Layout from '@/layouts/Layout.astro';
import { getProjects } from '@/lib/content-tina';

export async function getStaticPaths() {
  const categories = ['photography', 'video-art', 'documentary', 'printmaking', 'others'];
  return categories.map((category) => ({
    params: { category },
    props: { categoryName: category },
  }));
}

const { category } = Astro.params;
const { categoryName } = Astro.props;

// Helper to format category title
const formatTitle = (slug: string) => {
    return slug
      .split('-')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');
}

const allProjects = await getProjects();
const projects = allProjects.filter((project) => project.category === categoryName);

// Sort by year desc or order
projects.sort((a, b) => {
  const orderA = a.order ?? 99;
  const orderB = b.order ?? 99;
  if (orderA !== orderB) return orderA - orderB;
  return (b.year || '0').localeCompare(a.year || '0');
});
---

<Layout title={`${formatTitle(categoryName)} | Projects`}>
  <div class="px-6 md:px-12 py-12">
    <div class="flex items-baseline gap-4 mb-12">
        <h1 class="text-3xl font-light uppercase tracking-wide">{formatTitle(categoryName)}</h1>
        <a href="/projects" class="text-sm text-muted-foreground hover:text-foreground transition-colors uppercase tracking-widest">View All</a>
    </div>
    
    {projects.length === 0 ? (
        <p class="text-muted-foreground font-light">No projects found in this category.</p>
    ) : (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 gap-y-12">
        {projects.map((project) => (
            <a href={`/projects/${project._sys.filename}`} class="group block">
            <div class="aspect-[4/3] bg-muted overflow-hidden mb-4 relative">
                {project.coverImage ? (
                    <img 
                    src={project.coverImage} 
                    alt={project.title} 
                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                    />
                ) : (
                    <div class="w-full h-full flex items-center justify-center text-muted-foreground uppercase tracking-widest text-xs">
                    No Cover
                    </div>
                )}
            </div>
            <h2 class="text-lg font-normal group-hover:text-muted-foreground transition-colors uppercase tracking-wide">
                {project.title}
            </h2>
            {project.year && (
                <p class="text-xs text-muted-foreground mt-1">{project.year}</p>
            )}
            </a>
        ))}
        </div>
    )}
  </div>
</Layout>
