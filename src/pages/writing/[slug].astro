---
import Layout from '@/layouts/Layout.astro';
import { getWritings } from '@/lib/content-tina';
import { RichText } from '@/components/tina/RichText';

export async function getStaticPaths() {
  const writings = await getWritings();
  return writings.map((essay) => ({
    params: { slug: essay._sys.filename },
    props: { essay },
  }));
}

const { essay } = Astro.props;
const { title, date, coverImage, body } = essay;

const formatDate = (dateString: string) => {
  if (!dateString) return '';
  const date = new Date(dateString);
  return new Intl.DateTimeFormat('en-GB', {
    day: 'numeric',
    month: 'long',
    year: 'numeric',
  }).format(date);
};
---

<Layout title={`${title} | Mark Power`}>
  <article class="px-6 md:px-12 py-12 max-w-3xl mx-auto">
    <header class="mb-12">
      <h1 class="text-3xl md:text-5xl font-light mb-6 uppercase tracking-wide">{title}</h1>
      <div class="text-xs uppercase tracking-widest text-muted-foreground">
        <time datetime={date}>{formatDate(date)}</time>
      </div>
    </header>
    
    {coverImage && (
      <div class="mb-12">
        <img 
          src={coverImage} 
          alt={title}
          class="w-full h-auto"
        />
      </div>
    )}
    
    <div class="prose prose-lg prose-neutral max-w-none text-foreground">
      <RichText content={body} client:visible />
    </div>
  </article>
</Layout>
