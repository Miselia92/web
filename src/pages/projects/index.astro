---
import Layout from '@/layouts/Layout.astro';
import { getProjects } from '@/lib/content-tina';
import OptimizedImage from '@/components/OptimizedImage.astro';

const projects = await getProjects();
// Sort by year desc or order
projects.sort((a, b) => {
  const orderA = a.order ?? 99;
  const orderB = b.order ?? 99;
  if (orderA !== orderB) return orderA - orderB;
  return (b.year || '0').localeCompare(a.year || '0');
});
---

<Layout title="Projects | Mark Power">
  <div class="px-6 md:px-12 py-12">
    <h1 class="text-3xl font-light mb-12 uppercase tracking-wide">Projects</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 gap-y-12">
      {projects.map((project) => (
        <a href={`/projects/${project._sys.filename}`} class="group block">
          <div class="aspect-[4/3] bg-muted overflow-hidden mb-4 relative">
             {project.coverImage ? (
                <OptimizedImage 
                  src={project.coverImage} 
                  alt={project.title} 
                  class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                />
             ) : (
                <div class="w-full h-full flex items-center justify-center text-muted-foreground uppercase tracking-widest text-xs">
                  No Cover
                </div>
             )}
          </div>
          <h2 class="text-lg font-normal group-hover:text-muted-foreground transition-colors uppercase tracking-wide">
            {project.title}
          </h2>
          {project.year && (
            <p class="text-xs text-muted-foreground mt-1">{project.year}</p>
          )}
        </a>
      ))}
    </div>
  </div>
</Layout>
